<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <title>SWAPI MCP IA</title>
    <style>
        body { background: #222; color: #f5f5f5; font-family: "Segoe UI", Arial, sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 20px auto; background: #333; border-radius: 12px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3); padding: 32px 24px; }
        h2 { text-align: center; margin-bottom: 24px; color: #ffd700; letter-spacing: 1px; }
        form { display: flex; flex-direction: column; gap: 16px; }
        textarea { padding: 12px; border-radius: 6px; border: 1px solid #444; background: #222; color: #ffd700; font-size: 1rem; min-height: 60px; resize: vertical; }
        input[type="submit"], .clarify-btn { background: #ffd700; color: #222; border: none; border-radius: 6px; padding: 12px 0; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: background 0.2s; width: 100%; text-align: center; text-decoration: none; display: inline-block; }
        input[type="submit"]:hover, .clarify-btn:hover { background: #e6c200; }
        .spinner { display: none; margin: 24px auto; border: 6px solid #ffd700; border-top: 6px solid #222; border-radius: 50%; width: 48px; height: 48px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #response-area { margin-top: 24px; }
        .result-box, .error-box, .clarify-box { background: #222; border-radius: 8px; padding: 16px; margin-top: 16px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); }
        .result-box h3, .clarify-box h3 { color: #ffd700; margin-top: 0; }
        .result-box pre { white-space: pre-wrap; word-wrap: break-word; color: #fff; font-size: 1rem; }
        .error-box { background-color: #5a2828; color: #ffc2c2; }
        .clarify-box form { gap: 10px; }
        .clarify-btn { font-size: 1rem; padding: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Faça uma pergunta para o MCP IA</h2>

        <!-- Formulário de Busca Principal -->
        <form method="post" id="mcpForm">
            <textarea name="query" placeholder="Ex: quem é luke skywalker? procure o planeta tatooine, me mostre todos os filmes...">{{ query or '' }}</textarea>
            <input type="submit" value="Consultar" />
        </form>

        <div id="response-area">
            <div class="spinner" id="spinner"></div>

            <!-- Bloco de Ambiguidade -->
            {% if ambiguous_tools %}
            <div class="clarify-box">
                <h3>Sua busca é ambígua. O que você quis dizer?</h3>
                <form method="post">
                    <input type="hidden" name="param" value="{{ original_param }}">
                    {% for tool in ambiguous_tools %}
                        <button type="submit" name="chosen_tool" value="{{ tool }}" class="clarify-btn">
                            Buscar por "{{ original_param }}" em {{ tool.replace('_', ' ') | title }}
                        </button>
                    {% endfor %}
                </form>
            </div>
            {% endif %}

            <!-- Bloco de Erro -->
            {% if error_message %}
            <div class="error-box">
                <strong>Erro:</strong> {{ error_message }}
            </div>
            {% endif %}

            <!-- Bloco de Resultado -->
            {% if result %}
            <div class="result-box">
                <h3>Resultado:</h3>
                <pre>{{ result }}</pre>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        // Mostra o spinner durante o envio do formulário para dar feedback ao usuário
        const form = document.getElementById("mcpForm");
        const spinner = document.getElementById("spinner");
        const responseArea = document.getElementById('response-area');

        form.addEventListener("submit", function () {
            // Limpa a área de resposta anterior antes de mostrar o spinner
            responseArea.innerHTML = '';
            const newSpinner = spinner.cloneNode(true);
            responseArea.appendChild(newSpinner);
            newSpinner.style.display = "block";
        });

        // Garante que o spinner não fique visível após o carregamento da página
        window.addEventListener("DOMContentLoaded", function () {
            const initialSpinner = document.getElementById('spinner');
            if (initialSpinner) {
                initialSpinner.style.display = 'none';
            }
        });
    </script>
</body>
</html>

